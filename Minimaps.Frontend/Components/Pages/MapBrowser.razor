@page "/map/{MapId:int?}/{Version?}/{X?}/{Y?}/{Z?}"
@using Minimaps.Frontend.Components.Layout
@inject IConfiguration Configuration
@inject IWebHostEnvironment Environment
@layout Empty

<div data-page-module="/js/dist/map-viewer.js" data-page-init="MapViewerInit"></div>

<div class="map-viewport">
    <canvas id="map-canvas" data-tile-base-url="@TileBaseUrl" data-debug-enabled="@DebugEnabled.ToString().ToLower()"></canvas>

    <div id="debug-panel-container"></div>

    <div id="map-control-panel" class="map-controls">
        <div class="control-header">
            <svg class="map-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20.5 3L20.34 3.03L15 5.1L9 3L3.36 4.9C3.15 4.97 3 5.15 3 5.38V20.5C3 20.78 3.22 21 3.5 21L3.66 20.97L9 18.9L15 21L20.64 19.1C20.85 19.03 21 18.85 21 18.62V3.5C21 3.22 20.78 3 20.5 3ZM15 19L9 16.89V5L15 7.11V19Z" fill="currentColor"/>
            </svg>
            <h2 class="control-title">Minimap Explorer</h2>
        </div>

        <div class="control-section">
            <div class="dropdown-wrapper">
                <input
                    id="map-search-input"
                    type="text"
                    class="map-search-input"
                    autocomplete="off" />
                <div id="map-dropdown" class="dropdown-menu" style="display: none;"></div>
            </div>
        </div>

        <div class="control-section">
            <select id="version-selector" class="version-selector">
                <option value="latest">latest</option>
            </select>
            <div id="version-warning" class="version-warning hidden"></div>
        </div>

        <div class="control-divider"></div>

        <div class="control-section layers-section">
            <h3 class="layers-title">Layers</h3>
            <div id="layers-tree" class="layers-tree"></div>
        </div>
    </div>

    <div id="map-footer-overlay" class="footer-overlay">
        <a href="https://github.com/jimbomcb/wow-minimaps">Minimap Explorer</a> By John McBroom | Map Data Â© Blizzard Entertainment
    </div>
</div>

@code {
    [Parameter] public int? MapId { get; set; } = 0;
    [Parameter] public string? Version { get; set; }
    [Parameter] public string? X { get; set; }
    [Parameter] public string? Y { get; set; }
    [Parameter] public string? Z { get; set; }

    private string TileBaseUrl => Configuration["TileBaseUrl"] ?? "/data/tile/";

    // nothing in here that matters, just internal dev shit like the texture streamer states, debug viz.
    private bool DebugEnabled => Environment.IsDevelopment() && (Configuration.GetValue<bool?>("DebugPanel:Enabled") ?? true);
}